<!doctype html>
<html lang='en'>
  <head>
    <meta name='twitter:card' content='summary' />
    <meta property='og:title' content='Reading a YAML Configuration File in Kotlin' />
    <meta property='og:url' content='https://seansoper.com/blog/reading_yaml_configuration_file_kotlin.html' />
    <meta property='og:description' content='During the heyday of Ruby development 10 years ago the YAML format was all the rage. But as developers moved towards Javascript-powered frameworks like node the preferred format for configuration files moved with them to JSON. It was the Java community, which had been enthrall to XML for the better part of a decade, that began to roll out better support for YAML.' />
    <meta property='og:image' content='//source.unsplash.com/xDjcU1Pglro/1200x627' />
    <!-- Generated by zebec https://github.com/ssoper/Zebec -->
    <meta charset='utf-8' />
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no' />
    <meta name='ICBM' content='39.0840, 77.1528' />
    <title>Reading a YAML Configuration File in Kotlin by Sean Soper</title>
    <link type='image/x-icon' href='/favicon.ico' rel='shortcut icon' />
    <link type='application/rss+xml' title='eat. code. stocks.' href='/blog/rss.xml' rel='alternate' />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js'></script>
      <script src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js'></script>
    <![endif]-->
  </head>
  <body>
    <!-- Navigation -->
    <nav class='navbar navbar-expand-lg navbar-dark bg-dark fixed-top'>
      <div class='container'>
        <a class='navbar-brand' title='eat. code. stocks.' href='/blog'>üç± üë®üèª‚Äçüíª üè¶</a>
        <button class='navbar-toggler' type='button' data-toggle='collapse' data-target='#navbarResponsive' aria-controls='navbarResponsive' aria-expanded='false' aria-label='Toggle navigation'>
          <span class='navbar-toggler-icon'></span>
        </button>
        <div class='collapse navbar-collapse' id='navbarResponsive'>
          <ul class='navbar-nav ml-auto'>
            <li class='nav-item'>
              <a class='nav-link' href='/'>Home</a>
            </li>
            <li class='nav-item'>
              <a class='nav-link' href='/blog'>Blog</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Page Content -->
    <div class='container'>
      <div class='row'>
        <div class='col-lg-8 content'>
          <h1 class='mt-4'>Reading a YAML Configuration File in Kotlin</h1><h2 class='subtitle'>Adding a dependency on Jackson in your Gradle file</h2><div class='author'>
  <img src='/images/avatar_normal.jpg' alt='' srcset='/images/avatar_normal.jpg 1x, /images/avatar_retina.jpg 2x'/>
  <ul>
    <li>Sean Soper</li>
    <li>October 13, 2020</li>
  </ul>
</div><img class='img-fluid rounded' alt='' src='//source.unsplash.com/xDjcU1Pglro/900x300' srcset='//source.unsplash.com/xDjcU1Pglro/900x300 1x, //source.unsplash.com/xDjcU1Pglro/1800x600 2x'><p>During the heyday of Ruby development 10 years ago the YAML format was all the rage. But as developers moved towards Javascript-powered frameworks like <a href="https://nodejs.org/">node</a> the preferred format for configuration files moved with them to JSON. It was the Java community, which had been enthrall to XML for the better part of a decade, that began to roll out better support for YAML.</p><p>This post builds on work previously done in <a href="/blog/reading_command_line.html">Reading from the Command-Line in Kotlin</a>.</p><h2>Structure</h2><p>While command-line switches can take you pretty far they eventually become cumbersome to manage and it‚Äôs at this point that I like to introduce a configuration file. Ours will be in YAML format and will reference account information that is required to obtain an E*TRADE token. I‚Äôm also aiming to keep it extensible should we want to access other brokerage accounts.</p><p>Here is the basic structure:</p><pre><code>
etrade:
  sandbox:
    key: value
    secret: value
  production:
    key: value
    secret: value
  username: value
  password: value        
</code></pre><p>When creating a <code>data class</code> to map to this structure we should start with the leaf nodes.</p><pre><code>
data class EtradeAuth(val key: String,
                      val secret: String)
</code></pre><p>This single class can be used for both the <code>sandbox</code> and <code>production</code> values.</p><pre><code>
data class EtradeConfiguration(val sandbox: EtradeAuth,
                               val production: EtradeAuth,
                               val username: String,
                               val password: String)
                               
data class Configuration(val etrade: EtradeConfiguration
</code></pre><p>Note that none of these fields are optional or have default values so all the fields are required if we are to ingest the YAML file successfully.</p><h2>Jackson</h2><p>I don‚Äôt have a whole lot to add to these already fantastic <a href="https://www.mkammerer.de/blog/kotlin-and-yaml-part-2/">blog</a> <a href="https://www.baeldung.com/jackson-yaml">posts</a> on integrating and using Jackson in your project. But I do want to note some of the steps necessary to ensure the JAR file you build has all the required dependencies.</p><p>Since we are using Maven we can <a href="https://search.maven.org/search?q=fasterxml%20jackson%20dataformat">search</a> for the Jackson dependency and add them to our Gradle file. At a minimum we will need the Kotlin module and YAML dataformat either of which will pull in the main Jackson dependency.</p><pre><code>
dependencies {
    implementation(&quot;org.jetbrains.kotlin:kotlin-stdlib&quot;)
    
    // These are the new dependencies
    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin:2.11.2&quot;)
    implementation(&quot;com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.11.2&quot;)
}
</code></pre><p>Note that the string is split into three parts with a <code>:</code> as the separator. The version specification, which follows <a href="https://semver.org/">semver</a>, is unnecessary if you want to let the version point to whatever is the latest available.</p><h2>Ingest</h2><p>Let‚Äôs create a new class <code>IngestConfiguration</code> where we can centralize this functionality. Using some of the fantastic pathing and file functionality provided by Java out of the box, we can use the current directory to search for a file called <code>batil.yaml</code>, read it in and pass it to Jackson to parse.</p><pre><code>
fun parse(): Configuration {
    val path = Paths.get(basePath, &quot;batil.yaml&quot;)
    val mapper = ObjectMapper(YAMLFactory())
    mapper.registerModule(KotlinModule())
    
    return try {
        Files.newBufferedReader(path).use {
            mapper.readValue(it, Configuration::class.java)
        }
    } catch (exception: MissingKotlinParameterException) {
        println(&quot;Could not read YAML file!&quot;)
        println(exception.message)
    }
}
</code></pre><p>To ensure our JAR file has all the necessary dependencies we‚Äôll want to go into our <code>Project Structure</code> ‚û° <code>Artifacts</code>, select the dependencies that came down with Jackson, right click and select <code>Extract Into Output Root</code>. Without this step the JAR will still compile but will fail when it attempts to ingest the YAML files.</p><img src="/images/blog/reading_yaml_configuration_file_kotlin/extract.png" alt="Structure Screenshot" class="img-fluid rounded embedded">
<p>Note that after adding a dependency you may need to reaffirm the <code>Inherit project compile output path</code> radio button selection under <code>Modules</code>. You‚Äôll also want to update your <code>.gitignore</code> to avoid accidentally committing any tokens that should remain a secret. And as always, a summary of these commits can be found <a href="https://github.com/ssoper/Batil/compare/8428dd..35dba93">here</a>.</p>
        </div>
        <!-- Sidebar Widgets Column -->
        <div class='col-md-4'>
          <!-- Search Widget -->
          <div class='card my-4'>
            <h5 class='card-header'>Search</h5>
            <div class='card-body'>
              <div class='input-group'>
                <input class='form-control' placeholder='Search for‚Ä¶' id='search-query' type='text' />
                <span class='input-group-btn'>
                  <button class='btn btn-secondary' type='button' id='search-button'>Go!</button>
                </span>
              </div>
            </div>
          </div>
          <a href='/blog/rss.xml'><img width='72' src='https://shields.io/badge/rss-2.0-blue?logo=rss'></a>
        </div>
      </div>
    </div>
    <!-- jQuery -->
    <script integrity='sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n' crossorigin='anonymous' src='https://code.jquery.com/jquery-3.4.1.slim.min.js'></script>
    <!-- Popper -->
    <script integrity='sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo' crossorigin='anonymous' src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js'></script>
    <!-- Bootstrap -->
    <script integrity='sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6' crossorigin='anonymous' src='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js'></script>
    <!-- highlight.js -->
    <script src='//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js'></script>
    <!-- Delay loading of some assets for Google PageSpeed optimizations -->
    <noscript id='deferred-styles'>
      <link href='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css' integrity='sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh' crossorigin='anonymous' rel='stylesheet' />
      <link href='/css/blog.min.css' rel='stylesheet' />
      <link href='//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/default.min.css' rel='stylesheet' />
    </noscript>
    <script src='/js/load_deferred_styles.min.js'></script>
    <script src='/js/load_highlight.min.js'></script>
    <script src='/js/load_search.min.js'></script>
    <!-- Google Analytics -->
    <script async src='https://www.googletagmanager.com/gtag/js?id=G-N2516DN82V'></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N2516DN82V');
    </script>
  </body>
</html>